# 입출력 시스템과 디스크 관리

## 입출력 시스템

### 입출력 장치와 채널

컴퓨터에는 필수 장치(CPU, 메모리)와 주변장치(입출력장치, 저장장치)로 구성된다. 다양한 주변장치는 데이터 전송 속도에 따라 **저속 주변장치**와 **고속 주변장치**로 구분된다. 각 장치는 메인 보드에 있는 버스로 연결된다.

- **저속 주변장치**: 메모리와 주변장치 사에이 오고 가는 데이터 양이 적어 데이터 전송률이 낮은 장치. ex) 키보드, 마우스, 스캐너
- **고속 주변장치**: 메모리와 주변장치 사에이 오고 가는 데이터 양이 많아 데이터 전송률이 높은 장치. ex) 그래픽 카드(초당 수집장의 그래픽을 보여주어야 함)

버스는 여러 개의 버스를 묶어서 사용한다. 그 통로를 **채널**이라고 한다. 여러 채널을 효율적으로 사용하기 위해 전송 속도가 비슷한 장치끼리 묶어서 채널을 할당한다.

<br>

### 입출력 버스의 구조

#### 폴링 방식(초기 구조)
![img](./img/polling.png)

초기에는 모든 장치가 하나의 버스로 연결되고, CPU가 작업을 진행하다가 입출력 명령을 만나면 직접 입출력 장치에서 데이터를 가져왔는데 이를 **폴링(polling) 방식**이라고 한다.

- 폴링 방식: 하드웨어 상태를 수시로 체크하여 명령을 받을 수 있는지 확인

그러나 주변 장치는 CPU와 메모리보다 매우 느리다. 따라서 폴링 방식을 사용하면 CPU 대기 시간이 길어져 작업의 속도가 매우 느려진다.

#### 입출력 제어기를 사용한 구조
![IO](./img/iocontroller2.png)

CPU와 메모리 성능이 향상되고, 주변 장치 종류가 다양해졌다. 폴링 방식의 한계 때문에 모든 입출력을 **입출력 제어기(I/O Controller)에** 맡기는 구조로 바뀌었다.

입출력 제어기는 2개의 채널로 나뉜다. **메인버스**는 고속으로 작동하는 CPU와 메모리를, **입출력 버스**는 주변장치가 사용한다. 입출력 버스는 다시 **고속 입출력 버스**와 **저속 입출력 버스**로 분리해서 운영한다. (두 버스 사이의 데이터 전송은 채널 선택기가 관리)

이로인해 폴링 방식의 단점을 해결하여 전체 작업 효율이 향상된다.



### 직접 메모리 접근

직접 메모리 접근(DMA)은 CPU의 도움 없이 메모리에 접근할 수 있도록 입출력 제어기에 부여된 권한이다. 입출력 제어기에는 직접 메모리에 접근하기 위한 **DMA 제어기**가 마련되어 있다.

![IO2](./img/3.png)

입출력 제어기의 채널 선택기가 여러 채널에서 전송 받은 데이터 중 어떤 것을 메모리로 보낼지 정하고, 전송된 데이터는 DMA 제어기를 거쳐 메모리에 올라간다.

반대로 메모리에서 주변장치로 데이터를 전송할 때는 DMA 제어기가 메모리에서 데이터를 가져오면 채널 선택기에서 적당한 채널로 전송한다.




### 인터럽트

인터럽트는 입출력 제어기가 주변장치의 입출력 요구나 하드웨어 이상 현상을 CPU에 알려주는 역할을 하는 신호다.

ex) CPU가 요청 한 작업을 완료했을 때, 키보드로 데이터를 입력받았을 때, 네트워크 카드에 새로운 데이터가 도착했을 때, 하드웨어에 이상이 생겼을 때.

CPU는 인터럽트를 받아도 어떤 장치의 인터럽트인지 확인하기 어렵다. 따라서 각 장치에는 **IRQ**라는 고유의 인터럽트 번호가 부여되어 있고, IRQ를 통해 CPU는 어떤 장치에서 발생한 인터럽트인지 파악한다.

- 외부 인터럽트: 입출력 및 하드웨어 관련 인터럽트(ex. 전원 이상, 기계적 오류)
- 내부 인터럽트: 프로세스의 오류로 발생하는 인터럽트(ex. 숫자 0으로 나누기, 주소공간 벗어나는 작업하기)
- 시그널: 사용자의 요청으로 발생하는 인터럽트(ex. 리눅스에서 ctrl + c로 작동중인 프로세스 끝내기)

